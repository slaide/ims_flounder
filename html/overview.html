<!DOCTYPE html>
<html lang="eng">
   <head>
      <title>Room overview</title>
      <meta charset="UTF-8">
      <link rel="stylesheet" type="text/css" href="./reset.css">
      <link rel="stylesheet" type="text/css" href="./flounder.css">
   </head>

   <body>
      <!--Navigation menu for users-->
      <nav class="menu">
         <ul>
            <li><a href="#">Book an instrument</a></li>
            <li><a href="#">My Schedule</a></li>
            <li><a href="#">Administrator</a></li>
            <li><a href="#">Maintenance</a></li>
         </ul>
      </nav>
      
      <main id="overview_cont">

         <!--Display using grid or something like that, 2 columns, one for room_overview and one for schedule-->
         <h1 class="overview_title">Room overview</h1>
         <div id="room_overview"></div>

         <h1 class="overview_title">Book an instrument</h1>
         <div id="schedule">
            <p>Select a room and instrument</p>
         </div>

         <script>

            function getRooms() {
               var xhttp = new XMLHttpRequest();
               xhttp.open("GET", "room.json", true);
               xhttp.onreadystatechange = function() {
                  if (this.readyState == 4 && this.status == 200) {
                     var resObj = JSON.parse(this.responseText);
                     let overview = document.querySelector('#room_overview');
                     for (let i = 0; i < resObj.rooms.length; i++) {
                        let room_container = document.createElement('div');
                           overview.appendChild(room_container);
                        let room = document.createElement('button');
                           room.setAttribute('type', 'button');
                           //Change to room ID in getIns(${resObj.rooms[i].RoomID})
                           room.setAttribute('onclick', `getIns(${resObj.rooms[i].RoomCode})`);
                           room.setAttribute('class','room');
                           room.innerHTML = 'Room ' + resObj.rooms[i].RoomCode;
                        room_container.appendChild(room);
                        let instruments = document.createElement('div');
                           instruments.setAttribute('id', `ins_${resObj.rooms[i].RoomCode}`);
                        room_container.appendChild(instruments);

                     }
                  }  
               };
               xhttp.send();
            }

            
            //Function for showing instruments when a room button is clicked
            //instruments.json must contain insID and ins_description
            function getIns(RoomCode) {
            //$('').empty();
            var xhttp = new XMLHttpRequest();
            xhttp.open("GET", "instruments.json", true);
            xhttp.onreadystatechange = function() {
               if (this.readyState == 4 && this.status == 200) {
                  var resObj = JSON.parse(this.responseText);
                  for (let i = 0; i < resObj.instruments.length; i++) {
                     let instruments = document.querySelector(`#ins_${RoomCode}`);
                     let ins = document.createElement('button');
                        ins.setAttribute('type', 'button');
                        ins.setAttribute('onclick',`getSched()`);
                        ins.innerHTML = resObj.instruments[i].description;
                     instruments.appendChild(ins);
                  }
               }
            };
            xhttp.send(RoomCode);
         }

            //Function for displaying instrument booking options/instrument schedule
            //All booking information for one instrument that is choosen
            //Do we want a display of the weekly schedule, or many weeks
            // TEMPORARY //
            function getSched() {
               $("#schedule").empty();
               var xhttp = new XMLHttpRequest();
               xhttp.open("GET", "ins_booking.json", true);
               xhttp.onreadystatechange = function() {
                  if (this.readyState == 4 && this.status == 200) {
                     let schedule = document.querySelector('#schedule');
                     let booking_form = document.createElement('form');
                        booking_form.setAttribute('id','booking_form');
                        booking_form.setAttribute('action','/booking');
                        booking_form.setAttribute('method','POST');
                        schedule.appendChild(booking_form);
                     let label_date = document.createElement('label');
                        label_date.setAttribute('for', 'date');
                        booking_form.appendChild(label_date);
                     let input_date = document.createElement('input');
                        input_date.setAttribute('type','date');
                        input_date.setAttribute('id','date');
                        booking_form.appendChild(input_date);
                     
                  }
               }
               xhttp.send();
            }

            getRooms();              

         </script>

      </main>

   </body>
</html>