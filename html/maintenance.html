<!DOCTYPE html>
<html lang="eng">
  <head>
    <title>Maintenence</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="./reset.css">
    <link rel="stylesheet" type="text/css" href="./flounder.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <!--<style>@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');</style>-->

  </head>

  <body>
    <!--Navigation menu for users-->
    <nav class="menu">
       <ul>
          <li><a href="./overview.html">Book an instrument</a></li>
          <li><a href="./my_schedule.html">My Schedule</a></li>
          <li><a href="./">Administrator</a></li>
          <li><a href="./maintenance.html">Maintenance</a></li>
       </ul>
    </nav>
    
    <main id="whole_page">
      <h1>Maintenance</h1>
      <div id="select_ins">
        <h1>Select instrument</h1>
        <p id="test"><p>
        <select id="instrument_menu" name="instrument_menu">
        </select>
      <div id="maintenance_overview">
        <h1>Maintanence overview</h1>
        <div id="leave_note">
          <h2>Leave note</h2>
        </div>
        <div id="see_notes">
          <h2>See earlier notes</h2>
        </div>
      </div>

      <div id="lmao"></div>

      <script>

         //Email and SSN storage
         var email = $$EMAIL$$
         var ssn = $$SSN$$
         if (typeof(Storage) !== "undefined") {
               localStorage.setItem(email,ssn);
            } else {
               //would probably look terrible without style added... oh well hope it never happens
               document.querySelector('#overview_cont').innerHTML = "Sorry, your web browser does not support web storage."
            }


         function hello_world() {
         document.querySelector('#lmao').innerHTML = "hello world";
         //  let ins_menu = document.querySelector('#lmao');
         //  let room_alt = document.createElement('div');
         //  ins_menu.innerHTML = "Hello world";
         //  ins_menu.appendChild(room_alt);
         }
         //hello_world();

         function getRooms() {
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "/get_rooms", true);
            xhttp.onreadystatechange = function() {
               if (this.readyState == 4 && this.status == 200) {
                  var rooms = JSON.parse(this.responseText);
                  if (rooms.error) {
                     console.log(rooms.error)
                     return;
                  }
                  let ins_menu = document.querySelector("#instrument_menu");
                  for (let i = 0; i < rooms.length; i++) {
                     populateMenu(rooms[i].RoomID, rooms[i].RoomCode);
                     //let room_alt = document.createElement('option');
                     //room_alt.innerHTML = 'Room ' + rooms[i].RoomCode;
                     //ins_menu.appendChild(room_alt);
                     //room_alt.setAttribute('class', 'room_alt');
                     //let room_name = document.createTextNode(rooms[i]);
                     //room_alt.appendChild(room_name);
                  }
               }
            };
            xhttp.send(JSON.stringify({'ssn':ssn}));
         }

         function populateMenu(RoomID, RoomCode) {
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "/get_instruments_in_room", true);
            xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
               var instruments = JSON.parse(this.responseText);
               if (instruments.error) {
                  console.log(instruments.error)
                  return;
               }
               document.querySelector('#lmao').innerHTML = instruments.length;
               let ins_menu = document.querySelector("#instrument_menu");
               for (let i = 0; i < instruments.length; i++) {
                  let ins_alt = document.createElement('option');
                  ins_alt.innerHTML = 'Room ' + RoomCode + ": " + instruments[i].description;
                  ins_menu.appendChild(ins_alt);
                  }
            }
         };
         xhttp.send(JSON.stringify({'RoomID': RoomID, 'ssn': ssn}));
        }
        getRooms();
/*
        function getNotes(Ins_ID) {
          var xhttp = new XMLHttpRequest();
          xhttp.open("POST", "/get_maintenance", true);
          xhttp.onreadystatechange = function() {
            if (this.readState == 4 && this.status == 200) {
              var maintenance_notes = JSON.parse(this.responseText);
              if (maintenance_notes.error) {
                console.log(booking.error);
                return;
              }

              let 
            }
            if (maintenance.error)
          }
        }
*/
        //hello_world();
      </script>

<!--
      <div>
      <h>Leave a note for a machine</h>
        <div>
          <form action="/action_page.php" id="usrform">
            <h>Select machine</h>
            <select id="machines" name="machines">
              <option value="PCR1">PCR 1, room 1</option>
              <option value="PCR2">PCR 2, room 1</option>
              <option value="Incubator1">Incubator, room 2</option>
              <option value="Shaker1">Shaker, room 2</option>
              <option value="Coffe maker">Coffe maker, room 3</option>
            </select><br>
            <label for="date">Date:</label>
            <input type="date" id="date" name="maintenance-date">
            <label for="time">Time:</label>
            <input type="time" id="time"><br>
            <label for="note">Note:</label><br>
            <textarea rows="4" cols="50" name="note" form="usrform"></textarea><br>
            <input type="submit" value="Submit">
          </form><br><br>
        </div>

      <div>
        <h>See list of past maintenance</h>
        <table><tr><th>Machine</th><th>Room</th><th>Date</th><th>Time</th><th>By</th><th>Note</th></tr>
          <tr><th>PCR1</th><th>1</th><th>2021/02/19</th><th>08:15 AM</th><th>Steve Johnsson</th><th>Fixed the machine boss</th></tr>
          <tr><th>PCR1</th><th>1</th><th>2021/02/15</th><th>04:45 PM</th><th>John Makrsson</th><th>Changed the rotar and blades</th></tr>
          <tr><th>PCR2</th><th>1</th><th>2021/02/10</th><th>01:15 PM</th><th>margaret Smith </th><th>Changed blinker fluid</th></tr>
          <tr><th>Shaker</th><th>2</th><th>2021/02/4</th><th>03:30 PM</th><th>Sleve McDichael</th><th>Put in new cables</th></tr>
          <tr><th>Coffe maker</th><th>3</th><th>2021/01/13</th><th>08:30 AM</th><th>Rey McSriff</th><th>New filter</th></tr>

        </table>
      </div>
      -->

    </main>

  </body>
</html>
