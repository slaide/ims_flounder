<!DOCTYPE html>
<html lang="eng">
  <head>
    <title>Maintenence</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="./reset.css">
    <link rel="stylesheet" type="text/css" href="./flounder.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <!--<style>@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');</style>-->

  </head>

  <body>
    <!--Navigation menu for users-->
    <nav class="menu">
         <img src="./favicon.ico" width="256" height="256">
         <ul>
            <a href="./overview.html"><li>Book an instrument</li></a>
            <a href="./my_schedule.html"><li>My Schedule</li></a>
            <a href="#"><li>Administrator</li></a>
            <a href="./maintenance.html"><li>Maintenance</li></a>
         </ul>
      </nav>
    
    <main id="whole_page">
      <h1>Maintenance</h1>
      <div id="select_ins">
        <h1>Select instrument</h1>
        <p id="test"><p>
        <form>
          <select id="instrument_menu" onsubmit="show_maintanance()" name="instrument_menu">
          </select>
          <input type="submit" value="select">
        </form>
      <div id="maintenance_overview">
        <h1>Maintanence overview</h1>
        <div id="leave_note">
          <h2>Leave note</h2>
        </div>
        <div id="see_notes">
          <table id="notes_table">
            <tr>
              <th>Date</th>
              <th>Time</th>
              <th>Status</th>
              <th>Notes</th>
              <!-- <td>object</td>-->
            </tr>
          </table>
          <h2>See earlier notes</h2>
        </div>
      </div>

      <div id="lmao"></div>

      <script>

         var ssn = localStorage.getItem("ssn");
          
         function hello_world() {
         document.querySelector('#lmao').innerHTML = "hello world";
         //  let ins_menu = document.querySelector('#lmao');
         //  let room_alt = document.createElement('div');
         //  ins_menu.innerHTML = "Hello world";
         //  ins_menu.appendChild(room_alt);
         }
         //hello_world();

         function getRooms() {
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "/get_rooms", true);
            xhttp.onreadystatechange = function() {
               if (this.readyState == 4 && this.status == 200) {
                  var rooms = JSON.parse(this.responseText);
                  if (rooms.error) {
                     console.log(rooms.error)
                     return;
                  }
                  let ins_menu = document.querySelector("#instrument_menu");
                  for (let i = 0; i < rooms.length; i++) {
                     populateMenu(rooms[i].RoomID);
                     //let room_alt = document.createElement('option');
                     //room_alt.innerHTML = 'Room ' + rooms[i].RoomID;
                     //ins_menu.appendChild(room_alt);
                     //room_alt.setAttribute('class', 'room_alt');
                     //let room_name = document.createTextNode(rooms[i]);
                     //room_alt.appendChild(room_name);
                  }
               }
            };
            xhttp.send(JSON.stringify({'ssn':ssn}));
         }

         function populateMenu(RoomID) {
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "/get_instruments_in_room", true);
            xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
               var instruments = JSON.parse(this.responseText);
               if (instruments.error) {
                  console.log(instruments.error);
                  return;
               }
               document.querySelector('#lmao').innerHTML = instruments.length;
               let ins_menu = document.querySelector("#instrument_menu");
               for (let i = 0; i < instruments.length; i++) {
                  let ins_alt = document.createElement('option');
                  //alert(instruments[i].InsID);
                  ins_alt.className = instruments[i].InsID;
                  ins_alt.innerHTML = 'Room ' + RoomID + ": " + instruments[i].description;
                  ins_menu.appendChild(ins_alt);
                  //show_maintanance(instruments[i].InsID);
                  }
            }
         };
         xhttp.send(JSON.stringify({'RoomID': RoomID, 'ssn': ssn}));
        }

        function show_maintanance(InsID) {
        //alert(InsID);
        //return false;
        // This part is not done, want to get the form to not redirect first
        /*
          alert(InsID);
          var data = new FormData();
          data.append('InsID', domcument.getElementById(""))
          var xhttp = new XMLHttpRequest();
          xhttp.open("POST", "/get_maintenance", true);
          xhttp.onreadystatechange = function() {
          var instruments = JSON.parse(this.responseText);
            if (this.readyState == 4 && this.status == 200) {
              console.log(instruents.error);
              return false;
            }
            document.querySelector('#lmao').innerHTML = "Hello orld";
            document.querySelector('#see_notes').innerHTML = "Hello orld";
            let see_notes = document.querySelector("#see_notes");
            alert("The form was submitted");

          };
          xhttp.send(JSON.stringify({'InsID': InsID}));*/
        }

        getRooms();
/*
        function getNotes(Ins_ID) {
          var xhttp = new XMLHttpRequest();
          xhttp.open("POST", "/get_maintenance", true);
          xhttp.onreadystatechange = function() {
            if (this.readState == 4 && this.status == 200) {
              var maintenance_notes = JSON.parse(this.responseText);
              if (maintenance_notes.error) {
                console.log(booking.error);
                return;
              }
              let 
            }
            if (maintenance.error)
          }
        }
*/
        //hello_world();
      </script>
    </main>

  </body>
</html>
