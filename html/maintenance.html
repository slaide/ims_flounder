<!DOCTYPE html>
<html lang="eng">
  <head>
    <title>Maintenence</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="./reset.css">
    <link rel="stylesheet" type="text/css" href="./flounder.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <!--<style>@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');</style>-->

  </head>

  <body>
    <!--Navigation menu for users-->
    <nav class="menu">
         <img src="./favicon.ico" width="256" height="256">
         <ul>
            <a href="./overview.html"><li>Book an instrument</li></a>
            <a href="./my_schedule.html"><li>My Schedule</li></a>
            <a href="#"><li>Administrator</li></a>
            <a href="./maintenance.html"><li>Maintenance</li></a>
         </ul>
      </nav>
    
    <main id="whole_page">
      <h1>Maintenance</h1>
      <div id="select_ins">
        <h1>Select instrument</h1>
        <p id="test"><p>
        <!--form action="javascript:test_print(this);" id="lmaolmao"-->
          <select id="instrument_menu"  onChange="javascript:test_print(this);" name="instrument_menu">
          </select>
          <!--button type="submit">Submit me!</button-->
        <!--  <input type="submit" value="select">  -->
        <!--/form-->

      <!--div id="maintenance_form">
        <h1>Maintenance form</h1>
        <form id="form">
          
        </form-->

      </div>
      <!--iframe width="0" height="0" border="0" name="dummyframe" id="dummyframe"></iframe-->
      <div id="maintenance_overview">
        <h1>Maintanence overview</h1>
        <div id="see_notes">
          <table id="notes_table">
            <tr>
              <th>Date</th>
              <th>Status</th>
              <th>Notes</th>
              <!-- <td>object</td>-->
            </tr>
          </table>
          <h2>See earlier notes</h2>
        </div>
      </div>

      <div id="lmao"></div>

      <script>

         var ssn = localStorage.getItem("ssn");
          
         function hello_world() {
         document.querySelector('#lmao').innerHTML = "hello world";
         //  let ins_menu = document.querySelector('#lmao');
         //  let room_alt = document.createElement('div');
         //  ins_menu.innerHTML = "Hello world";
         //  ins_menu.appendChild(room_alt);
         }
         //hello_world();

         function getRooms() {
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "/get_rooms", true);
            xhttp.onreadystatechange = function() {
               if (this.readyState == 4 && this.status == 200) {
                  var rooms = JSON.parse(this.responseText);
                  if (rooms.error) {
                     console.log(rooms.error)
                     return;
                  }
                  let ins_menu = document.querySelector("#instrument_menu");
                  for (let i = 0; i < rooms.length; i++) {
                    populateMenu(rooms[i].RoomID);
                     //let room_alt = document.createElement('option');
                     //room_alt.innerHTML = 'Room ' + rooms[i].RoomID;
                     //ins_menu.appendChild(room_alt);
                     //room_alt.setAttribute('class', 'room_alt');
                     //let room_name = document.createTextNode(rooms[i]);
                     //room_alt.appendChild(room_name);
                  }
               }
            };
            xhttp.send(JSON.stringify({'ssn':ssn}));
         }

         function populateMenu(RoomID) {
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "/get_instruments_in_room", true);
            xhttp.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                var instruments = JSON.parse(this.responseText);
                if (instruments.error) {
                  console.log(instruments.error);
                  return;
                }
                document.querySelector('#lmao').innerHTML = instruments.length;
                let ins_menu = document.querySelector("#instrument_menu");
                for (let i = 0; i < instruments.length; i++) {
                  let ins_alt = document.createElement('option');
                  //alert(instruments[i].InsID);
                  //ins_alt.className = instruments[i].InsID;
                  ins_alt.setAttribute("value", instruments[i].InsID);
                  ins_alt.innerHTML = 'Room ' + RoomID + ": " + instruments[i].description;
                  ins_menu.appendChild(ins_alt);
                  show_maintanance(instruments[i].InsID);
                  }
            }
         };
         xhttp.send(JSON.stringify({'RoomID': RoomID, 'ssn': ssn}));
        }

        function selected_ins(InsID) {
          add_maintanance(InsID);
        }

        function add_maintanance(InsID) {
          var xhttp = new XMLHttpRequest();
          xhttp.open("POST", "/add_maintanance", true);
          
        }

        function show_maintanance(InsID) {
        //alert(InsID);
        //return false;
        // This part is not done, want to get the form to not redirect first
          //var data = new FormData();
          //data.append('InsID', domcument.getElementById(""))
          var xhttp = new XMLHttpRequest();
          xhttp.open("POST", "/get_maintenance", true);
          xhttp.onreadystatechange = function() {
            //alert("Enter function");  //This runs like 19 times
            if (this.readyState == 4 && this.status == 200) {
              alert("we're in");
              var instrument_notes = JSON.parse(this.responseText);
              if (instrument.error) {
                console.log(instruents.error);
                //alert("Error");
                return false;
              }
              let table_element = document.querySelector("#notes_table");
              table_element.innerHTML = "";
              let table_header = document.createElement("tr");
              let table_header_time = document.createElement("th");
              table_header_time.innerHTML = "Date & Time";
              let table_header_status = document.createElement("th");
              table_header_status.innerHTML = "Status";
              let table_header_note = document.createElement("th");
              table_header_note.innerHTML = "Notes";
              table_header.appendChild(table_header_time);
              table_header.appendChild(table_header_status);
              table_header.appendChild(table_header_note);
              table_element.appendChild(table_header);
//              for (int i = 0; i < instrument_notes.length; i++) {

//              }
              alert("The form was submitted");
              alert(instrument);
            } 
            else if(this.status == 200){
              alert("error2");
            } else if(this.readyState == 4) {
              //alert("error3");
            } else {
              //alert("error4");
            }
          };
          xhttp.send(JSON.stringify({'InsID': InsID}));
        }

        function test_print(in_str) {
          var ins_IDXX = in_str[in_str.selectedIndex].value;
          document.querySelector('#lmao').innerHTML = ins_IDXX;

          let table_element = document.querySelector("#notes_table");
          table_element.innerHTML = "";
          let table_header = document.createElement("tr");
          let table_header_time = document.createElement("th");
          table_header_time.innerHTML = "Date & Time";
          let table_header_status = document.createElement("th");
          table_header_status.innerHTML = "Status";
          let table_header_note = document.createElement("th");
          table_header_note.innerHTML = "Notes";
          table_header.appendChild(table_header_time);
          table_header.appendChild(table_header_status);
          table_header.appendChild(table_header_note);
          table_element.appendChild(table_header);

          let table_entry = document.createElement("tr");
          let table_time = document.createElement("th");
          table_time.innerHTML = "2021/03/03 00:20";
          let table_status = document.createElement("th");
          table_status.innerHTML = "Working";
          let table_note = document.createElement("th");
          table_note.innerHTML = "Added a new lamp, all is working";
          table_entry.appendChild(table_time);
          table_entry.appendChild(table_status);
          table_entry.appendChild(table_note);
          table_element.appendChild(table_entry);

        }

        getRooms();

        //hello_world();
      </script>
    </main>

  </body>
</html>
